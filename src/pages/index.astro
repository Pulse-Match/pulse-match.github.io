---
import Layout from '../layouts/Layout.astro';
import WaitlistForm from '../components/WaitlistForm';
---

<Layout title="glid. | Join the Waitlist">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 w-full">
        <div class="glass-nav w-full px-6 md:px-12 py-4 flex items-center justify-between shadow-sm bg-white/65 border-white/40 dark:bg-dark-primary/65 dark:border-white/10 border-b">
            <div class="flex items-center gap-12">
                <a href="#" class="font-black text-xl tracking-tighter text-obsidian dark:text-white">glid<span class="text-cobalt">.</span></a>
                <div class="hidden md:flex gap-6">
                    <a href="#how-it-works" class="text-sm font-bold text-gray-500 hover:text-black dark:hover:text-white transition-colors">HOW IT WORKS</a>
                    <a href="#sports" class="text-sm font-bold text-gray-500 hover:text-black dark:hover:text-white transition-colors">SPORTS</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <!-- Dark Mode Toggle -->
                <button onclick="window.toggleTheme()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors" aria-label="Toggle Dark Mode">
                    <svg class="w-5 h-5 hidden dark:block text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg class="w-5 h-5 block dark:hidden text-obsidian" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
                <div class="hidden sm:flex items-center gap-3">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cobalt opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-cobalt"></span>
                    </span>
                    <span class="font-mono text-xs font-bold text-cobalt tracking-wide">COMING SOON</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Scroll Trigger Container (400vh height to create scroll track) -->
    <div id="scroll-track" class="relative h-[400vh]">

        <!-- Sticky Viewport -->
        <div class="sticky top-0 h-screen w-full flex items-center justify-center overflow-hidden">

            <div class="max-w-7xl w-full px-6 md:px-12 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center h-full pt-20 pb-10">

                <!-- Left: Content & Form -->
                <div class="flex flex-col items-start gap-6 relative z-10 transition-opacity duration-500 h-full justify-center order-2 lg:order-1" id="hero-text">

                    <!-- Badge -->
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white border border-gray-200 dark:bg-white/10 dark:border-white/10 dark:text-gray-300">
                        <span class="w-2 h-2 rounded-full bg-cobalt animate-pulse"></span>
                        <span class="font-mono text-[10px] font-bold text-gray-500 dark:text-gray-300 uppercase tracking-widest">Be the First to Play</span>
                    </div>

                    <!-- Headline -->
                    <h1 class="text-5xl sm:text-7xl font-black text-obsidian dark:text-white uppercase tracking-tightest leading-[0.9]">
                        <span class="hidden lg:inline">Less <span class="text-gray-300 dark:text-gray-600">Talk.</span><br></span>
                        More <span class="text-cobalt">Game.</span>
                    </h1>

                    <p class="text-lg font-medium text-gray-500 dark:text-gray-400">
                        Swipe on sports sessions happening near you.
                    </p>

                    <!-- Waitlist Form (Glass Panel) - hidden on mobile, shown after scroll animation -->
                    <div class="hidden lg:block w-full">
                        <WaitlistForm client:load />
                    </div>

                    <div class="mt-8 flex flex-col items-center justify-center w-full text-gray-400 dark:text-gray-500">
                        <svg class="w-8 h-8 animate-bounce mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        <span class="font-mono text-sm uppercase tracking-widest font-bold">Scroll to Match</span>
                    </div>
                </div>

                <!-- Right: Interactive Phone -->
                <div class="relative w-full flex justify-center lg:justify-end h-full items-center order-1 lg:order-2" style="perspective: 1200px;">

                    <!-- System Log Popup -->
                    <div id="status-popup" class="status-pill absolute top-32 -left-4 md:-left-12 z-40 bg-white/90 dark:bg-dark-primary/90 backdrop-blur-md border border-gray-200 dark:border-white/10 shadow-xl rounded-xl p-4 flex items-center gap-3 max-w-[200px] pointer-events-none transition-all duration-300 opacity-0 translate-y-4">
                        <div id="status-indicator" class="w-2 h-2 rounded-full bg-gray-300"></div>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-mono text-gray-400 font-bold uppercase">System Log</span>
                            <span id="status-text" class="text-xs font-bold text-obsidian dark:text-white font-mono leading-tight">WAITING...</span>
                        </div>
                    </div>

                    <!-- Falling Cards (outside phone) -->
                    <div id="falling-cards" class="absolute inset-0 pointer-events-none z-30" style="perspective: 1200px;">
                        <!-- Cards will be injected here during fall animation -->
                    </div>

                    <!-- Phone Frame with 3D transform -->
                    <div id="phone-frame" class="relative w-[300px] md:w-[340px] h-[660px] bg-obsidian rounded-[3rem] border-4 border-gray-300 dark:border-gray-700 shadow-2xl z-20" style="transform-style: preserve-3d; transform: rotateX(70deg) rotateZ(-5deg) translateY(50px); transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);">
                        <!-- Bezel -->
                        <div class="absolute inset-1 bg-black rounded-[2.5rem] overflow-hidden">
                            <!-- Dynamic Island -->
                            <div class="absolute top-4 left-1/2 -translate-x-1/2 w-28 h-7 bg-black z-30 rounded-full flex items-center justify-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-800"></div>
                                <div class="w-10 h-1.5 rounded-full bg-gray-800/50"></div>
                            </div>

                            <!-- Screen Content -->
                            <div class="w-full h-full bg-vapor dark:bg-gray-900 relative flex flex-col pt-14 px-4 pb-8 overflow-hidden transition-colors">

                                <!-- App Header -->
                                <div class="flex justify-between items-center mb-6 px-2 relative z-10">
                                    <span class="font-black text-lg tracking-tighter text-obsidian dark:text-white">glid.</span>
                                    <div class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 shadow-sm flex items-center justify-center">
                                        <svg class="w-4 h-4 text-obsidian dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    </div>
                                </div>

                                <!-- Cards Container (inside phone) -->
                                <div class="relative flex-1 w-full" id="card-stack">
                                    <!-- Cards injected via JS after landing -->
                                </div>

                                <!-- Match Overlay -->
                                <div id="match-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-xl z-50 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
                                    <div class="text-white text-6xl font-black italic tracking-tighter mb-4">IT'S A<br><span class="text-cobalt">MATCH.</span></div>
                                    <p class="text-white/60 font-mono text-xs">YOU BOTH WANT TO PLAY</p>
                                </div>

                                <!-- Controls -->
                                <div class="h-20 flex items-center justify-center gap-8 mt-4 z-10">
                                    <div id="btn-reject" class="w-14 h-14 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-lg flex items-center justify-center text-gray-400 dark:text-gray-500 transition-all duration-200">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </div>
                                    <div id="btn-accept" class="w-14 h-14 rounded-full bg-cobalt shadow-lg shadow-cobalt/40 flex items-center justify-center text-white transition-all duration-200">
                                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Glow behind phone -->
                    <div class="absolute inset-0 bg-cobalt blur-[100px] opacity-20 -z-10 rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile CTA Section (visible only on mobile after scroll animation) -->
    <section class="lg:hidden px-6 py-16 bg-white dark:bg-dark-surface border-t border-gray-100 dark:border-white/5">
        <div class="max-w-md mx-auto text-center">
            <h2 class="text-3xl font-black tracking-tightest text-obsidian dark:text-white uppercase italic mb-4">
                Ready to <span class="text-cobalt">Play?</span>
            </h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 font-medium mb-6">
                Join the waitlist and be the first to match with players in your area.
            </p>
            <WaitlistForm client:load />
        </div>
    </section>

    <!-- How It Works Section (Bento Grid) -->
    <section id="how-it-works" class="px-6 md:px-12 py-24 max-w-7xl mx-auto z-10 relative bg-vapor dark:bg-dark-primary transition-colors">
        <div class="text-center mb-16">
            <span class="bg-black dark:bg-white text-white dark:text-black px-3 py-1 rounded-full text-xs font-mono font-bold uppercase tracking-widest mb-4 inline-block">The Process</span>
            <h2 class="text-4xl md:text-5xl font-black tracking-tightest text-obsidian dark:text-white uppercase italic">How <span class="text-cobalt">Glid</span> Works</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <!-- Step 1 -->
            <div class="bento-card rounded-3xl p-8 bg-white dark:bg-dark-surface transition-colors shadow-lift border border-gray-100 dark:border-white/5 group">
                <div class="w-16 h-16 bg-vapor dark:bg-white/10 rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform">üì±</div>
                <div class="font-mono text-xs text-cobalt font-bold mb-2">STEP_01</div>
                <h3 class="text-2xl font-black tracking-tight text-obsidian dark:text-white mb-3 italic uppercase">Browse Sessions</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 font-medium leading-relaxed">See open games at parks near you. Filter by sport, skill level, and time.</p>
            </div>

            <!-- Step 2 -->
            <div class="bento-card rounded-3xl p-8 bg-white dark:bg-dark-surface transition-colors shadow-lift border border-gray-100 dark:border-white/5 group">
                <div class="w-16 h-16 bg-vapor dark:bg-white/10 rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform">ü§ù</div>
                <div class="font-mono text-xs text-cobalt font-bold mb-2">STEP_02</div>
                <h3 class="text-2xl font-black tracking-tight text-obsidian dark:text-white mb-3 italic uppercase">Swipe & Match</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 font-medium leading-relaxed">Swipe right on games that fit your schedule. Match instantly and start chatting.</p>
            </div>

            <!-- Step 3 -->
            <div class="bento-card rounded-3xl p-8 bg-white dark:bg-dark-surface transition-colors shadow-lift border border-gray-100 dark:border-white/5 group">
                <div class="w-16 h-16 bg-vapor dark:bg-white/10 rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform">üéæ</div>
                <div class="font-mono text-xs text-cobalt font-bold mb-2">STEP_03</div>
                <h3 class="text-2xl font-black tracking-tight text-obsidian dark:text-white mb-3 italic uppercase">Show Up & Play</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 font-medium leading-relaxed">Grab your gear and enjoy the match. Rate your experience afterward.</p>
            </div>

        </div>
    </section>

    <!-- Sports Grid Section -->
    <section id="sports" class="py-24 px-6 border-t border-gray-200 dark:border-white/10">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-5xl font-black tracking-tightest text-obsidian dark:text-white uppercase italic">
                    Any Activity, <span class="text-cobalt">Any Time.</span>
                </h2>
                <p class="text-gray-500 dark:text-gray-400 mt-4 font-medium">Sports, fitness, outdoor adventures ‚Äî find your people.</p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üéæ</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Tennis</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üèÉ</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Running</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üèÄ</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Basketball</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üßò</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Yoga</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üö¥</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Cycling</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">‚öΩ</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Soccer</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">ü•æ</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Hiking</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üèä</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Swimming</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">‚õ≥</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Golf</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üèì</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Pickleball</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üèãÔ∏è</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">Gym</div>
                </div>
                <div class="group cursor-pointer p-6 rounded-2xl bg-white dark:bg-dark-surface border border-gray-100 dark:border-white/5 text-center hover:border-cobalt dark:hover:border-cobalt transition-colors shadow-sm hover:shadow-md">
                    <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">‚ûï</div>
                    <div class="font-bold text-xs uppercase tracking-wider text-obsidian dark:text-white">More</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-24 px-6 border-t border-gray-200 dark:border-white/10 bg-white dark:bg-dark-primary transition-colors">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl font-black tracking-tightest mb-8 text-gray-200 dark:text-gray-800 uppercase">
                Just Play.
            </h2>
            <div class="flex flex-col md:flex-row justify-center items-center gap-8 text-xs font-mono text-gray-400">
                <a href="#" class="hover:text-black dark:hover:text-white transition-colors">INSTAGRAM</a>
                <a href="#" class="hover:text-black dark:hover:text-white transition-colors">TWITTER</a>
                <a href="#" class="hover:text-black dark:hover:text-white transition-colors">CONTACT</a>
                <span>&copy; 2026 GLID INC.</span>
            </div>
        </div>
    </footer>

    <!-- SCROLL & ANIMATION LOGIC -->
    <script is:inline>
        const scrollTrack = document.getElementById('scroll-track');
        const cardStack = document.getElementById('card-stack');
        const fallingCards = document.getElementById('falling-cards');
        const phoneFrame = document.getElementById('phone-frame');
        const statusPopup = document.getElementById('status-popup');
        const statusText = document.getElementById('status-text');
        const statusIndicator = document.getElementById('status-indicator');
        const matchOverlay = document.getElementById('match-overlay');
        const btnReject = document.getElementById('btn-reject');
        const btnAccept = document.getElementById('btn-accept');

        // Session data with host info and ELO breakdown
        const sessions = [
            {
                sport: 'Tennis',
                venue: 'Sunset Tennis Club',
                time: '17:00',
                host: 'Marcus T.',
                elo: 1847,
                reliability: 94,
                skill: 4.2,
                vibe: 4.8,
                image: 'https://images.unsplash.com/photo-1554068865-24cecd4e34b8?auto=format&fit=crop&q=80&w=800'
            },
            {
                sport: 'Running',
                venue: 'Burke Lake Trail',
                time: '06:00',
                host: 'Sarah K.',
                elo: 1623,
                reliability: 88,
                skill: 3.5,
                vibe: 4.9,
                image: 'https://images.unsplash.com/photo-1552674605-db6ffd4facb5?auto=format&fit=crop&q=80&w=800'
            },
            {
                sport: 'Basketball',
                venue: 'Riverside Court',
                time: '18:30',
                host: 'Jordan M.',
                elo: 2104,
                reliability: 97,
                skill: 4.8,
                vibe: 4.5,
                image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&q=80&w=800'
            },
            {
                sport: 'Yoga',
                venue: 'Zen Studio',
                time: '07:00',
                host: 'Elena R.',
                elo: 1456,
                reliability: 91,
                skill: 3.0,
                vibe: 5.0,
                image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?auto=format&fit=crop&q=80&w=800'
            }
        ];

        let cards = [];
        let fallingCardElements = [];
        let cardsTransferred = false;

        // Create card HTML template
        function createCardHTML(p) {
            return `
                <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/20 to-black/95"></div>
                <div class="relative z-10">
                    <div class="absolute top-[-320px] left-0 right-0 flex justify-between items-start">
                        <span class="bg-white/90 backdrop-blur text-black px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider shadow-sm">
                            Live Now
                        </span>
                    </div>
                    <div class="mb-3">
                        <div class="flex items-center gap-2 mb-1">
                            <h2 class="text-2xl font-black italic uppercase text-white tracking-tighter">${p.sport}</h2>
                        </div>
                        <p class="text-white/70 text-[10px] font-mono font-bold uppercase tracking-widest">${p.venue} ‚Ä¢ ${p.time}</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-3 border border-white/10 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cobalt to-white/20 flex items-center justify-center text-white text-xs font-bold">${p.host.charAt(0)}</div>
                                <div>
                                    <div class="text-white font-bold text-sm">${p.host}</div>
                                    <div class="text-white/50 text-[9px] font-mono uppercase">Host</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-cobalt text-2xl font-black">${p.elo}</div>
                                <div class="text-white/50 text-[9px] font-mono uppercase">Glid ELO</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 pt-2 border-t border-white/10">
                            <div class="text-center">
                                <div class="text-white font-bold text-sm">${p.reliability}%</div>
                                <div class="text-white/50 text-[8px] font-mono uppercase">Reliability</div>
                            </div>
                            <div class="text-center border-x border-white/10">
                                <div class="text-white font-bold text-sm">${p.skill}</div>
                                <div class="text-white/50 text-[8px] font-mono uppercase">Skill</div>
                            </div>
                            <div class="text-center">
                                <div class="text-white font-bold text-sm">${p.vibe}</div>
                                <div class="text-white/50 text-[8px] font-mono uppercase">Vibe</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize falling cards (outside the phone)
        function initFallingCards() {
            fallingCards.innerHTML = '';
            sessions.forEach((p, i) => {
                const el = document.createElement('div');
                el.className = 'falling-card absolute rounded-3xl overflow-hidden shadow-2xl flex flex-col justify-end p-5';
                el.style.width = '240px';
                el.style.height = '380px';
                el.style.left = '50%';
                el.style.top = '50%';
                el.style.marginLeft = window.innerWidth < 1024 ? '-80px' : '40px';  // Shifted left on mobile
                el.style.marginTop = '-190px';
                el.style.zIndex = 10 - i;
                el.style.backgroundImage = `url('${p.image}')`;
                el.style.backgroundSize = 'cover';
                el.style.backgroundPosition = 'center';
                // Start position: above and rotated in 3D space
                el.style.transform = `translateY(-800px) translateZ(200px) rotateX(-20deg) rotateZ(${(i - 1.5) * 15}deg)`;
                el.style.opacity = '0';
                el.style.transition = 'none';
                el.innerHTML = createCardHTML(p);
                fallingCards.appendChild(el);
            });
            fallingCardElements = Array.from(document.querySelectorAll('.falling-card'));
        }

        // Initialize cards inside phone (hidden initially)
        function initStackCards() {
            cardStack.innerHTML = '';
            sessions.forEach((p, i) => {
                const el = document.createElement('div');
                el.className = 'app-card absolute top-0 left-0 flex flex-col justify-end p-5';
                el.style.zIndex = 10 - i;
                el.style.backgroundImage = `url('${p.image}')`;
                el.style.transform = 'scale(1)';
                el.style.opacity = '0';
                el.innerHTML = createCardHTML(p);
                cardStack.appendChild(el);
            });
            cards = Array.from(document.querySelectorAll('.app-card'));
        }

        initFallingCards();
        initStackCards();

        // SCROLL LISTENER
        window.addEventListener('scroll', () => {
            const trackRect = scrollTrack.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            let progress = -trackRect.top / (trackRect.height - viewportHeight);
            progress = Math.max(0, Math.min(1, progress));
            updateAnimation(progress);
        });

        function updateAnimation(progress) {
            // PHASE 0: Cards falling onto flat phone (0.0 - 0.2)
            if (progress < 0.2) {
                const phaseP = progress / 0.2;

                // Phone stays completely flat during card fall
                phoneFrame.style.transform = `rotateX(70deg) rotateZ(-5deg) translateY(50px)`;

                // Animate falling cards with stagger
                fallingCardElements.forEach((card, i) => {
                    const stagger = i * 0.12;
                    let fallP = (phaseP - stagger) * 1.3;
                    fallP = Math.max(0, Math.min(1, fallP));

                    // Easing for bounce effect at landing
                    let ease;
                    if (fallP < 0.7) {
                        ease = Math.pow(fallP / 0.7, 2);
                    } else {
                        // Bounce
                        const bounceP = (fallP - 0.7) / 0.3;
                        ease = 1 - Math.sin(bounceP * Math.PI) * 0.08;
                    }

                    const yPos = -600 + (ease * 600);
                    const zPos = 150 - (ease * 150);
                    const rotX = -15 + (ease * 15);
                    const rotZ = (i - 1.5) * 12 * (1 - ease);
                    const scale = 0.85 + (ease * 0.15);

                    card.style.transform = `translateY(${yPos}px) translateZ(${zPos}px) rotateX(${rotX}deg) rotateZ(${rotZ}deg) scale(${scale})`;
                    card.style.opacity = `${Math.min(1, fallP * 2.5)}`;
                });

                // Hide cards inside phone
                cards.forEach(card => { card.style.opacity = '0'; });

                statusPopup.style.opacity = '1';
                statusPopup.style.transform = 'translateY(0)';
                updateStatus("LOADING_SESSIONS...", "bg-gray-300");
                matchOverlay.style.opacity = 0;
            }
            // PHASE 1: Cards settled, brief pause (0.2 - 0.25)
            else if (progress >= 0.2 && progress < 0.25) {
                // Phone still flat, cards fully landed
                phoneFrame.style.transform = `rotateX(70deg) rotateZ(-5deg) translateY(50px)`;

                // Cards resting on phone
                fallingCardElements.forEach((card, i) => {
                    const stackOffset = i * 8;
                    card.style.transform = `translateY(${stackOffset}px) translateZ(0) rotateX(0) rotateZ(0) scale(1)`;
                    card.style.opacity = '1';
                });

                cards.forEach(card => { card.style.opacity = '0'; });
                updateStatus("SESSIONS_LOADED", "bg-success");
            }
            // PHASE 2: Phone rotates to face user (0.25 - 0.4)
            else if (progress >= 0.25 && progress < 0.4) {
                const phaseP = (progress - 0.25) / 0.15;

                // Smooth easing for rotation
                const ease = 1 - Math.pow(1 - phaseP, 3);

                // Phone rotates from laying flat to facing user
                const phoneRotateX = 70 * (1 - ease);
                const phoneRotateZ = -5 * (1 - ease);
                const phoneTranslateY = 50 * (1 - ease);
                phoneFrame.style.transform = `rotateX(${phoneRotateX}deg) rotateZ(${phoneRotateZ}deg) translateY(${phoneTranslateY}px)`;

                // Fade out falling cards as phone rotates
                fallingCardElements.forEach((card, i) => {
                    card.style.opacity = `${1 - ease}`;
                    const shrink = 1 - (ease * 0.5);
                    card.style.transform = `translateY(0) scale(${shrink})`;
                });

                // Fade in cards inside phone with stack effect
                cards.forEach((card, i) => {
                    const scale = 1 - (i * 0.05);
                    const yOffset = i * 10;
                    card.style.transform = `translateY(${yOffset}%) scale(${scale})`;
                    card.style.opacity = `${ease}`;
                });

                updateStatus("SYNCING_LIVE_DATA...", "bg-cobalt pulse-dot");
            }
            // PHASE 3: Swipe Right (0.4 - 0.55)
            else if (progress >= 0.4 && progress < 0.55) {
                // Ensure phone is fully rotated
                phoneFrame.style.transform = 'rotateX(0) rotateZ(0) translateY(0)';
                fallingCardElements.forEach(card => { card.style.opacity = '0'; });

                const phaseP = (progress - 0.4) / 0.15;
                const rotate = phaseP * 15;
                const tx = phaseP * 120;
                const opacity = 1 - phaseP;

                cards[0].style.transform = `translateX(${tx}%) rotate(${rotate}deg) scale(1)`;
                cards[0].style.opacity = opacity;

                // Keep other cards in stack
                for (let i = 1; i < cards.length; i++) {
                    const scale = 1 - ((i - phaseP) * 0.05);
                    const yOffset = (i - phaseP) * 10;
                    cards[i].style.transform = `translateY(${Math.max(0, yOffset)}%) scale(${Math.min(1, scale)})`;
                    cards[i].style.opacity = '1';
                }

                if(phaseP > 0.1) {
                    btnAccept.style.transform = "scale(1.2)";
                } else {
                    btnAccept.style.transform = "scale(1)";
                }
                btnReject.style.transform = "scale(1)";
                btnReject.style.color = "";
                updateStatus(`ANALYZING: ${sessions[0].sport}...`, "bg-cobalt pulse-dot");
            }
            // PHASE 4: Swipe Left (0.55 - 0.7)
            else if (progress >= 0.55 && progress < 0.7) {
                const phaseP = (progress - 0.55) / 0.15;
                cards[0].style.opacity = '0';

                const rotate = phaseP * -15;
                const tx = phaseP * -120;
                const opacity = 1 - phaseP;

                cards[1].style.transform = `translateX(${tx}%) rotate(${rotate}deg) scale(0.95)`;
                cards[1].style.opacity = opacity;

                // Move remaining cards up
                for (let i = 2; i < cards.length; i++) {
                    const scale = 1 - ((i - 1 - phaseP) * 0.05);
                    const yOffset = (i - 1 - phaseP) * 10;
                    cards[i].style.transform = `translateY(${Math.max(0, yOffset)}%) scale(${Math.min(1, scale)})`;
                }

                if(phaseP > 0.1) {
                    btnReject.style.transform = "scale(1.2)";
                    btnReject.style.color = "#FF3B30";
                }
                btnAccept.style.transform = "scale(1)";
                updateStatus("FILTER: DISTANCE > 5KM", "bg-destructive pulse-dot");
            }
            // PHASE 5: Match (0.7 - 1.0)
            else if (progress >= 0.7) {
                cards[0].style.opacity = '0';
                cards[1].style.opacity = '0';
                cards[2].style.transform = 'scale(1)';
                cards[2].style.opacity = '1';
                if (cards[3]) {
                    cards[3].style.transform = 'translateY(10%) scale(0.95)';
                    cards[3].style.opacity = '1';
                }
                btnReject.style.transform = "scale(1)";
                btnReject.style.color = "";
                btnAccept.style.transform = "scale(1)";

                const phaseP = (progress - 0.7) / 0.3;
                if (phaseP > 0.1) {
                    matchOverlay.style.opacity = 1;
                    updateStatus("MATCH CONFIRMED", "bg-success");
                } else {
                    matchOverlay.style.opacity = 0;
                }
            }
        }

        function updateStatus(text, dotClass) {
            statusText.textContent = text;
            statusIndicator.className = `w-2 h-2 rounded-full ${dotClass}`;
        }
    </script>
</Layout>
